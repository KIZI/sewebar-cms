<?php

require_once './Bootstrap.php';
require_once '../config/Config.php';

use IZI\Encoder\URLEncoder;
use IZI\Parser\DataParser;
use IZI\Serializer\TaskSettingSerializer;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;

$request = Request::createFromGlobals();
$id = $request->query->get('id_dm');
$data = $request->request->has('data') ? $request->request->get('data') : $request->query->get('data');
$debug = json_decode($data)->debug;
$lang = $request->query->get('lang');
$sleep = (int) $request->query->get('sleep') ?: 0;

if ($id === 'TEST') {
    sleep($sleep); // simulates time required for mining
    $taskPath = 'data/4ft_sample_task.pmml';
    $resultPath = 'data/4ft_sample_result.pmml';
    $DP = new DataParser(DDPath, unserialize(FLPath), FGCPath, APP_PATH.'/web/'.$resultPath, null, $lang);
    $DP->loadData();
    $DP->parseData();
    $responseContent = $DP->getER();
    $responseContent['task'] = $taskPath;
    $responseContent['result'] = $resultPath;
    $responseContent['status'] = 'ok';
    $responseContent = '{"rules":[{"id":33383,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"< 20"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33384,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<20;50)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.9519230769}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33385,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8983261004}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33386,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1016738996}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33387,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8882608696}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33388,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1117391304}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33389,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.7685950413}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33390,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.2314049587}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33391,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33392,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.2}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33393,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33394,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"< 20"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33395,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<20;50)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.9523809524}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33396,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8988902589}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33397,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1011097411}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33398,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8882608696}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33399,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1117391304}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33400,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.7704918033}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33401,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.2295081967}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33402,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8333333333}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33403,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"1 year"},{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1666666667}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33404,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33405,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"< 20"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33406,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<20;50)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.9523809524}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33407,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8988902589}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33408,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1011097411}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33409,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8882608696}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33410,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1117391304}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33411,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.7704918033}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33412,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.2295081967}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33413,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8333333333}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33414,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1666666667}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33415,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33416,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"< 20"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33417,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<20;50)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.9537037037}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33418,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8994481913}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33419,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1005518087}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33420,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8891285591}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33421,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1108714409}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33422,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.776}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33423,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<250;500)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.224}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33424,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8888888889}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33425,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"2 years"},{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":">= 500"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1111111111}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33426,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33427,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"< 20"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":1}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33428,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<20;50)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.953271028}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33429,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8988902589}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33430,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<50;100)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1011097411}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]},{"id":33431,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.8891285591}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"good"}],"sign":"positive"}]},{"id":33432,"antecedent":[{"name":"District","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"Benesov"}],"sign":"positive"},{"name":"AND","type":"and","category":"","fields":[]},{"name":"(","type":"lbrac","category":"","fields":[],"sign":"positive"},{"name":"Duration","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"3 years"}],"sign":"positive"},{"name":"OR","type":"or","category":"","fields":[]},{"name":"Amount","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"<100;250)"}],"sign":"positive"},{"name":")","type":"rbrac","category":"","fields":[]}],"IM":[{"name":"FUI","type":"im","category":"","fields":{"name":"threshold","value":0.1108714409}}],"consequent":[{"name":"Quality","type":"attr","category":"One category","active":false,"fields":[{"name":"coef","value":"bad"}],"sign":"positive"}]}],"taskState":"Interrupted","task":"temp\/4ft_task_1207_173738.pmml","result":"temp\/4ft_result_1207_173755.pmml","status":"ok"}';
    $response = new Response($responseContent, 200, array('content-type' => 'application/json; charset=UTF-8'));
    $response->send();
    die;
} else { // KBI
    $DDPath = APP_PATH.'/web/temp/DD_'.$id.'.pmml';
    if (!file_exists($DDPath)) {
        if (FB_ENABLED && $debug) { // log into console
            FB::error(['error' => 'data description does not exist']);
        }
        $responseContent = ['status' => 'error'];
        goto sendResponse;
    }

    $serializer = new TaskSettingSerializer($DDPath);
    $requestData = array('source' => $id, 'query' => $serializer->serialize($data), 'template' => $debug ? '4ftMiner.Task.Template.PMML' : '4ftMiner.Task.ARD.Template.PMML');
    $numRequests = 0;

    // save LM task
    $taskPath = 'temp/4ft_task_'.date('md_His').'.pmml';
    file_put_contents($taskPath, $requestData['query']);

    $encoder = new URLEncoder();

    // run task
    sendRequest:
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, "http://sewebar.lmcloud.vse.cz/index.php?option=com_kbi&task=query&format=raw");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $encoder->encode($requestData));
    curl_setopt($ch, CURLOPT_VERBOSE, false);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);

    $response = curl_exec($ch);
    $info = curl_getinfo($ch);
    curl_close($ch);

    $ok = ($info['http_code'] === 200 && strpos($response, 'kbierror') === false && !preg_match('/status=\"failure\"/', $response));
    if ((++$numRequests < MAX_MINING_REQUESTS) && !$ok) { sleep(REQUEST_DELAY); goto sendRequest; }

    if (FB_ENABLED && $debug) { // log into console
        FB::info(['num requests' => $numRequests, 'curl request' => $requestData, 'curl response' => $response, 'curl info' => $info]);
    }

    if ($ok) {
        // save LM result
        $resultPath = 'temp/4ft_result_'.date('md_His').'.pmml';
        file_put_contents($resultPath, $response);

        $DP = new DataParser($DDPath, unserialize(FLPath), FGCPath, $response, null, $lang);
        $DP->loadData();
        $DP->parseData();
        $responseContent = $DP->getER();
        $responseContent['task'] = $taskPath;
        $responseContent['result'] = $resultPath;
        $responseContent['status'] = 'ok';
    } else {
        $responseContent = ['status' => 'error'];
    }
}

sendResponse:
$response = new Response(json_encode($responseContent), 200, array('content-type' => 'application/json; charset=UTF-8'));
$response->send();

